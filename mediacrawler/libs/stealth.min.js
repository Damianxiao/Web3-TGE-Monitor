// Stealth script to prevent bot detection
(() => {
  const originalQuery = window.navigator.permissions.query;
  return window.navigator.permissions.query = (parameters) => (
    parameters.name === 'notifications' ?
      Promise.resolve({ state: Notification.permission }) :
      originalQuery(parameters)
  );
})();

(() => {
  Object.defineProperty(navigator, 'webdriver', {
    get: () => undefined,
  });
})();

(() => {
  window.navigator.chrome = {
    runtime: {},
  };
})();

(() => {
  const originalQuery = window.navigator.permissions.query;
  return window.navigator.permissions.query = (parameters) => (
    parameters.name === 'notifications' ?
      Promise.resolve({ state: Notification.permission }) :
      originalQuery(parameters)
  );
})();

(() => {
  Object.defineProperty(navigator, 'plugins', {
    get: () => [1, 2, 3, 4, 5],
  });
})();

(() => {
  Object.defineProperty(navigator, 'languages', {
    get: () => ['en-US', 'en'],
  });
})();

(() => {
  const getParameter = WebGLRenderingContext.getParameter;
  WebGLRenderingContext.prototype.getParameter = function(parameter) {
    if (parameter === 37445) {
      return 'Intel Inc.';
    }
    if (parameter === 37446) {
      return 'Intel Iris OpenGL Engine';
    }
    return getParameter(parameter);
  };
})();

(() => {
  const elementDescriptor = Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'offsetHeight');
  Object.defineProperty(HTMLDivElement.prototype, 'offsetHeight', {
    ...elementDescriptor,
    get: function() {
      if (this.id === 'modernizr') {
          return 1;
      }
      return elementDescriptor.get.apply(this);
    },
  });
})();

(() => {
  const mediaDevices = navigator.mediaDevices;
  if (mediaDevices && mediaDevices.enumerateDevices) {
    navigator.mediaDevices.enumerateDevices = () => Promise.resolve([
      {
        deviceId: 'default',
        groupId: 'default',
        kind: 'audioinput',
        label: 'Default - Microphone (Built-in)',
      },
      {
        deviceId: 'default',
        groupId: 'default',
        kind: 'audiooutput',
        label: 'Default - Speaker (Built-in)',
      },
    ]);
  }
})();